# MamaCare Backend Deployment to Render

This guide will help you deploy your MamaCare backend to Render and connect it with your Netlify frontend.

## Prerequisites

1. A GitHub account with your MamaCare repository
2. A Render account (free tier available)
3. Your Netlify frontend already deployed

## Step 1: Prepare Your Backend for Render

### 1.1 Update Database Configuration
The backend has been updated to use environment variables for database configuration:
- `DATABASE_URL` will be automatically set by Render
- Fallback to local Docker database for development

### 1.2 CORS Configuration
CORS has been configured to allow requests from:
- Localhost (development)
- Netlify domains (`*.netlify.app`, `*.netlify.com`)
- Your specific Netlify domain

### 1.3 Required Environment Variables
You'll need to set these in Render:

**Database (Auto-configured by Render):**
- `DATABASE_URL` - Automatically set from Render PostgreSQL

**Security:**
- `SECRET_KEY` - Auto-generated by Render

**Email Configuration:**
- `EMAIL_USER` - Your Gmail address
- `EMAIL_PASSWORD` - Your Gmail app password

**Twilio SMS (Optional):**
- `TWILIO_ACCOUNT_SID` - Your Twilio Account SID
- `TWILIO_AUTH_TOKEN` - Your Twilio Auth Token
- `TWILIO_PHONE_NUMBER` - Your Twilio phone number

**Other:**
- `FLASK_ENV` - Set to "production"
- `PYTHONUNBUFFERED` - Set to "1"
- `TIMEZONE` - Set to "Africa/Freetown"

## Step 2: Deploy to Render

### 2.1 Connect Your GitHub Repository

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" and select "Web Service"
3. Connect your GitHub account if not already connected
4. Select your MamaCare repository

### 2.2 Configure the Web Service

**Basic Settings:**
- **Name:** `mamacare-backend`
- **Environment:** `Python 3`
- **Region:** `Frankfurt` (or closest to your users)
- **Branch:** `main` (or your default branch)

**Build & Deploy Settings:**
- **Build Command:** `pip install -r backend/requirements.txt && pip install gunicorn`
- **Start Command:** `cd backend && gunicorn --bind 0.0.0.0:$PORT app:app`

### 2.3 Create PostgreSQL Database

1. In Render Dashboard, click "New +" and select "PostgreSQL"
2. Configure:
   - **Name:** `mamacare-db`
   - **Database:** `mamacare`
   - **User:** `mamacare`
   - **Plan:** `Free` (or paid for production)
   - **Region:** Same as your web service

### 2.4 Set Environment Variables

In your web service settings, add these environment variables:

**Required:**
```
SECRET_KEY = [Auto-generated by Render]
DATABASE_URL = [Auto-linked from PostgreSQL]
FLASK_ENV = production
PYTHONUNBUFFERED = 1
TIMEZONE = Africa/Freetown
```

**Email (Required for notifications):**
```
EMAIL_USER = your-email@gmail.com
EMAIL_PASSWORD = your-gmail-app-password
```

**Twilio (Optional for SMS):**
```
TWILIO_ACCOUNT_SID = your-twilio-sid
TWILIO_AUTH_TOKEN = your-twilio-token
TWILIO_PHONE_NUMBER = your-twilio-number
```

### 2.5 Deploy

1. Click "Create Web Service"
2. Render will automatically build and deploy your application
3. Wait for the build to complete (usually 5-10 minutes)

## Step 3: Update Frontend Configuration

### 3.1 Update config.js

Once deployed, update your `config.js` file with your actual Render URL:

```javascript
// Production configuration (Render)
production: {
    apiBaseUrl: 'https://your-app-name.onrender.com', // Replace with your actual URL
    environment: 'production'
}
```

### 3.2 Update HTML Files

Add the config.js script to all your HTML files that make API calls:

```html
<script src="config.js"></script>
```

### 3.3 Update API Calls

Replace hardcoded `localhost:5000` URLs with configurable ones:

**Before:**
```javascript
const response = await fetch('http://localhost:5000/api/patient/register', {
```

**After:**
```javascript
const response = await fetch(`${window.MamaCareConfig.apiBaseUrl}/api/patient/register`, {
```

Or use the helper function:
```javascript
const response = await apiFetch('/api/patient/register', {
```

## Step 4: Test Your Deployment

### 4.1 Health Check
Visit your Render URL + `/health` to verify the backend is running:
```
https://your-app-name.onrender.com/health
```

### 4.2 Test API Endpoints
Test a few key endpoints:
- `GET /api/hospitals`
- `GET /api/doctors`
- `GET /api/pharmacies`

### 4.3 Test Frontend Integration
1. Deploy updated frontend to Netlify
2. Test that frontend can communicate with Render backend
3. Check browser console for any CORS errors

## Step 5: Database Migration

### 5.1 Run Migrations
If you have database migrations, you'll need to run them:

1. Connect to your Render service via SSH (if available)
2. Or add a migration script to your deployment

### 5.2 Initialize Database
Your app includes an `init_db()` function that will create tables if they don't exist.

## Step 6: Monitor and Maintain

### 6.1 Monitor Logs
- Check Render logs for any errors
- Monitor database connections
- Watch for CORS issues

### 6.2 Performance
- Free tier has limitations (sleeps after 15 minutes of inactivity)
- Consider upgrading for production use

### 6.3 Security
- Keep environment variables secure
- Regularly update dependencies
- Monitor for security vulnerabilities

## Troubleshooting

### Common Issues:

1. **Build Failures:**
   - Check requirements.txt for compatibility
   - Verify Python version compatibility

2. **Database Connection Issues:**
   - Verify DATABASE_URL is correctly set
   - Check PostgreSQL service is running

3. **CORS Errors:**
   - Verify CORS configuration in app.py
   - Check that your Netlify domain is allowed

4. **Environment Variables:**
   - Ensure all required variables are set
   - Check for typos in variable names

### Support:
- Render Documentation: https://render.com/docs
- Render Community: https://community.render.com/

## Next Steps

1. Set up custom domain (optional)
2. Configure SSL certificates
3. Set up monitoring and alerts
4. Implement CI/CD pipeline
5. Add backup strategies for database

## Cost Considerations

**Free Tier Limits:**
- 750 hours/month for web services
- 1GB RAM, 0.1 CPU
- Sleeps after 15 minutes of inactivity
- 1GB PostgreSQL database

**Paid Plans:**
- $7/month for always-on web service
- $7/month for PostgreSQL database
- Better performance and reliability

---

**Note:** Remember to update your frontend's `config.js` with the actual Render URL once deployed! 