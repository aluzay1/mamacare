# MamaCare Deployment Fix Guide

## üéØ **Problem Solved**
Fixed SQLAlchemy compatibility issues with Python 3.13 by using Python 3.11 and compatible packages.

## üìã **Recommended Configuration**

### **Python Version: 3.11.18**
- Most stable for our stack
- Compatible with all dependencies
- No typing issues

### **Key Dependencies**
```txt
Flask==2.2.5
Flask-SQLAlchemy==3.0.2
SQLAlchemy==1.4.41
psycopg2-binary==2.9.9
```

### **Database Configuration**
- URL: `postgresql+psycopg2://`
- Driver: `psycopg2-binary` (compatible with Python 3.11)

## üîß **Files Updated**

### 1. **backend/requirements.txt**
- Downgraded to SQLAlchemy 1.4.41
- Using psycopg2-binary for PostgreSQL
- Flask-SQLAlchemy 3.0.2 for compatibility

### 2. **backend/app.py**
- Database URL uses `postgresql+psycopg2://`
- Removed unused imports
- Compatible with Python 3.11

### 3. **render.yaml**
- Forces Python 3.11.18
- Sets all necessary environment variables
- Proper build and start commands

### 4. **runtime.txt**
- Specifies Python 3.11.18
- Provides fallback version specification

## üöÄ **Deployment Steps**

### **1. Environment Variables (Set in Render Dashboard)**
```
PYTHON_VERSION = 3.11.18
FLASK_DEBUG = False
PYTHONUNBUFFERED = 1
TIMEZONE = Africa/Freetown
SECRET_KEY = [Auto-generated by Render]
DATABASE_URL = [Auto-linked from PostgreSQL]
```

### **2. Database Setup**
- Create PostgreSQL database in Render
- Link it to your web service
- Render will auto-set DATABASE_URL

### **3. Build Configuration**
- Build Command: `pip install -r backend/requirements.txt && pip install gunicorn`
- Start Command: `cd backend && gunicorn --bind 0.0.0.0:$PORT app:app`

## ‚úÖ **Expected Results**

1. **‚úÖ Build Success** - All packages compatible with Python 3.11
2. **‚úÖ App Startup** - No SQLAlchemy typing errors
3. **‚úÖ Database Connection** - psycopg2-binary works perfectly
4. **‚úÖ Health Check** - `/health` endpoint returns healthy status

## üîç **Troubleshooting**

### **If still using Python 3.13:**
1. Check Render dashboard settings
2. Ensure `PYTHON_VERSION=3.11.18` is set
3. Redeploy the service

### **If database connection fails:**
1. Verify PostgreSQL database is created
2. Check DATABASE_URL environment variable
3. Ensure database is linked to web service

### **If build fails:**
1. Check requirements.txt syntax
2. Verify all package versions are compatible
3. Check Render logs for specific errors

## üìû **Support**

If issues persist:
1. Check Render deployment logs
2. Verify all environment variables are set
3. Ensure database is properly configured
4. Test locally with Python 3.11 first

---

**Last Updated:** January 2025
**Status:** ‚úÖ Ready for deployment 